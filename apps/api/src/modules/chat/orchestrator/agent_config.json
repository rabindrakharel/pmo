{
  "version": "3.0.0",
  "architecture": "goal-oriented-agentic",

  "goals": [
    {
      "goal_id": "UNDERSTAND_REQUEST",
      "description": "Understand what the customer needs help with",
      "goal_type": "conversational",
      "is_terminal": false,
      "primary_agent": "conversational_agent",
      "success_criteria": {
        "mandatory_fields": ["service.primary_request"],
        "quality_checks": ["issue_is_clear"]
      },
      "allowed_agents": ["conversational_agent", "extraction_agent"],
      "conversation_tactics": ["empathetic_listening", "clarifying_questions", "issue_confirmation"],
      "max_turns": 5,
      "retry_strategy": {
        "approach": "provide_examples",
        "escalation_turns": [3, 5]
      },
      "auto_advance_conditions": [
        {
          "type": "semi_deterministic",
          "json_path": "service.primary_request",
          "operator": "is_set",
          "next_goal": "GATHER_REQUIREMENTS"
        },
        {
          "type": "semantic",
          "condition": "customer has clearly stated their issue and we understand what help they need",
          "next_goal": "GATHER_REQUIREMENTS"
        }
      ]
    },
    {
      "goal_id": "GATHER_REQUIREMENTS",
      "description": "Collect necessary customer information",
      "goal_type": "conversational_with_mcp",
      "is_terminal": false,
      "primary_agent": "conversational_agent",
      "fallback_agent": "mcp_agent",
      "success_criteria": {
        "mandatory_fields": ["customer.phone", "customer.name", "customer.address"]
      },
      "allowed_agents": ["conversational_agent", "extraction_agent", "mcp_agent"],
      "available_tools": ["customer_get", "customer_create", "setting_list"],
      "conversation_tactics": ["incremental_data_gathering", "rapport_building"],
      "max_turns": 8,
      "agent_execution_strategy": {
        "mode": "parallel",
        "parallel_groups": [
          {
            "agents": ["conversational_agent", "extraction_agent"],
            "description": "Reply to customer while extracting data in parallel"
          }
        ]
      },
      "retry_strategy": {
        "approach": "vary_phrasing",
        "escalation_turns": [3, 5, 7],
        "escalation_messages": [
          "Try a different approach to ask for contact information",
          "Offer value - explain why you need their info",
          "Offer to proceed with partial information"
        ]
      },
      "auto_advance_conditions": [
        {
          "type": "semantic",
          "condition": "all mandatory fields collected (customer phone, name, and address) and customer information complete",
          "next_goal": "DESIGN_SOLUTION"
        }
      ]
    },
    {
      "goal_id": "DESIGN_SOLUTION",
      "description": "Create plan to resolve customer request",
      "goal_type": "planning",
      "is_terminal": false,
      "primary_agent": "planner_agent",
      "fallback_agent": "mcp_agent",
      "success_criteria": {
        "mandatory_fields": ["operations.solution_plan"]
      },
      "allowed_agents": ["planner_agent", "mcp_agent", "conversational_agent"],
      "available_tools": ["setting_list", "task_create"],
      "conversation_tactics": ["solution_explanation", "consent_gathering"],
      "max_turns": 6,
      "retry_strategy": {
        "approach": "revise_plan",
        "escalation_turns": [2, 4]
      },
      "auto_advance_conditions": [
        {
          "condition": "solution plan created and customer consents",
          "next_goal": "EXECUTE_SOLUTION"
        },
        {
          "condition": "customer rejects plan",
          "next_goal": "DESIGN_SOLUTION",
          "loop_prevention": { "max_iterations": 2 }
        }
      ]
    },
    {
      "goal_id": "EXECUTE_SOLUTION",
      "description": "Execute the planned actions",
      "goal_type": "execution",
      "is_terminal": false,
      "primary_agent": "mcp_agent",
      "fallback_agent": "conversational_agent",
      "success_criteria": {
        "mandatory_fields": ["operations.task_id"]
      },
      "allowed_agents": ["mcp_agent", "conversational_agent"],
      "available_tools": ["task_create", "person_calendar_book"],
      "conversation_tactics": ["progress_updates", "success_confirmation"],
      "max_turns": 6,
      "retry_strategy": {
        "approach": "retry_operation",
        "escalation_turns": [2, 4]
      },
      "auto_advance_conditions": [
        {
          "condition": "all actions executed successfully",
          "next_goal": "CONFIRM_RESOLUTION"
        }
      ]
    },
    {
      "goal_id": "CONFIRM_RESOLUTION",
      "description": "Verify satisfaction and close",
      "goal_type": "terminal",
      "is_terminal": true,
      "primary_agent": "conversational_agent",
      "fallback_agent": "mcp_agent",
      "success_criteria": {
        "mandatory_fields": []
      },
      "allowed_agents": ["conversational_agent", "mcp_agent"],
      "available_tools": ["call_hangup"],
      "conversation_tactics": ["satisfaction_check", "graceful_closure"],
      "max_turns": 3,
      "retry_strategy": {
        "approach": "gentle_wrap_up",
        "escalation_turns": [2]
      },
      "termination_sequence": {
        "enabled": true,
        "steps": [
          {
            "step": 1,
            "action": "conversational_goodbye",
            "agent": "conversational_agent",
            "message_template": "Thank you for choosing Huron Home Services! We'll take care of everything. Have a great day!",
            "tactics": ["graceful_closure"]
          },
          {
            "step": 2,
            "action": "execute_mcp_hangup",
            "agent": "mcp_agent",
            "required_tool": "call_hangup",
            "description": "Terminate chat session via MCP"
          }
        ],
        "on_completion": "END"
      },
      "auto_advance_conditions": [
        {
          "condition": "customer satisfied and conversation closed",
          "next_goal": "END"
        }
      ]
    }
  ],

  "agent_profiles": {
    "conversational_agent": {
      "identity": "Empathetic customer service specialist",
      "capabilities": ["natural_conversation", "empathy_expression", "question_asking"],
      "personality_traits": {
        "empathy_level": "high",
        "formality": "professional_friendly",
        "verbosity": "concise"
      },
      "system_prompt": "You are an empathetic customer service agent for Huron Home Services.\n\nCore principles:\n1. Listen before asking - review conversation history FIRST\n2. Never repeat questions already answered\n3. Build trust through genuine empathy\n4. Keep responses concise (1-3 sentences)\n5. Match customer's emotional tone\n\nYour goal: Help customers efficiently while making them feel heard.",
      "tactics_library": {
        "empathetic_listening": "Acknowledge customer concern with understanding",
        "clarifying_questions": "Ask focused questions without interrogation",
        "rapport_building": "Build trust through reassurance",
        "incremental_data_gathering": "Request information naturally",
        "solution_explanation": "Explain plans clearly",
        "satisfaction_check": "Verify customer happiness",
        "graceful_closure": "End professionally and warmly"
      }
    },
    "extraction_agent": {
      "identity": "Information extraction specialist",
      "capabilities": ["entity_extraction", "intent_classification"],
      "system_prompt": "Extract structured information from conversations. Return JSON with extracted fields. Only extract explicitly stated information.",
      "extraction_schema": {
        "primary_request": {
          "type": "string",
          "extraction_strategy": "Extract MAIN issue customer wants help with"
        },
        "customer_phone": {
          "type": "string",
          "extraction_strategy": "Detect phone patterns or natural language numbers"
        },
        "customer_name": {
          "type": "string",
          "extraction_strategy": "Look for self-introductions"
        },
        "customer_address_street": {
          "type": "string",
          "extraction_strategy": "Extract street number and street name (e.g., '353531 Edmonton Avenue')"
        },
        "customer_address_city": {
          "type": "string",
          "extraction_strategy": "Extract city name (e.g., 'Palo Alto', 'Toronto')"
        },
        "customer_address_state": {
          "type": "string",
          "extraction_strategy": "Extract state/province (e.g., 'California', 'CA', 'Ontario', 'ON')"
        },
        "customer_address_zipcode": {
          "type": "string",
          "extraction_strategy": "Extract postal/zip code (e.g., '94301', 'M5V 3A8')"
        },
        "customer_address_country": {
          "type": "string",
          "extraction_strategy": "Extract country if explicitly mentioned (e.g., 'Canada', 'USA')"
        }
      }
    },
    "planner_agent": {
      "identity": "Service planning specialist",
      "capabilities": ["solution_design", "resource_matching"],
      "system_prompt": "Design solutions for service requests. Generate actionable plans with resources and timeline. Always provide alternatives.",
      "planning_strategies": {
        "service_matching": "Match issue to service catalog semantically",
        "resource_allocation": "Check employee availability",
        "timeline_estimation": "Estimate based on service complexity"
      }
    },
    "mcp_agent": {
      "identity": "External systems integration specialist",
      "capabilities": ["tool_selection", "api_execution", "customer_profile_management"],
      "system_prompt": "Execute external calls via MCP tools. Analyze context, select tool, execute with correct parameters, handle errors gracefully. PRIORITY: Create/update customer profiles with complete data (name, phone, email, fine-grained address) before proceeding to task creation.",
      "tool_selection_strategy": {
        "customer_get": "Use when customer.phone or customer.email exists but customer.id is empty. Search by phone or email.",
        "customer_create": "Use after customer_get returns no results. Create customer with name (required), phone, email, and fine-grained address (street, city, state, zipcode, country).",
        "customer_update": "Use when customer.id exists and new customer data is available. Update incrementally with fine-grained address fields (street, city, state, zipcode, country).",
        "task_create": "Use when solution approved and service identified. Task description is auto-enriched with customer data + conversation history.",
        "person_calendar_book": "Use when task_id exists and calendar slot available. Event is auto-enriched with task reference + attendees (customer email, employee email)."
      },
      "customer_profile_workflow": {
        "step_1": "Search for existing customer via customer_get (by phone or email)",
        "step_2": "If found: Update customer profile via customer_update with any new data (address components, email, etc.)",
        "step_3": "If not found: Create new customer profile via customer_create with all extracted data",
        "step_4": "Store customer.id in context for task/project linking",
        "required_fields_for_creation": ["name", "phone"],
        "optional_fields_for_creation": ["email", "address_street", "address_city", "address_state", "address_zipcode", "address_country"],
        "update_incrementally": true
      },
      "tool_enrichment_rules": {
        "task_create": {
          "enrich_field": "body_descr",
          "enrichment_type": "append_markdown",
          "sections": [
            {
              "title": "Customer Information",
              "source_paths": [
                { "label": "Name", "path": "customer.name" },
                { "label": "Phone", "path": "customer.phone" },
                { "label": "Email", "path": "customer.email" },
                { "label": "Address", "path": "customer.address", "format": "address_components", "components": ["address_street", "address_city", "address_state", "address_zipcode", "address_country"] }
              ]
            },
            {
              "title": "Service Request",
              "source_paths": [
                { "label": "Request", "path": "service.primary_request" },
                { "label": "Service Type", "path": "service.catalog_match" }
              ]
            },
            {
              "title": "Conversation History",
              "source_path": "summary_of_conversation_on_each_step_until_now",
              "format": "conversation_exchanges"
            }
          ]
        },
        "customer_create": {
          "enrichment_type": "field_mapping",
          "field_mappings": [
            { "source": "customer.name", "target": "body_name" },
            { "source": "customer.phone", "target": "body_primary_phone" },
            { "source": "customer.email", "target": "body_primary_email" },
            { "source": "customer.address_street", "target": "body_primary_address" },
            { "source": "customer.address_city", "target": "body_city" },
            { "source": "customer.address_state", "target": "body_province" },
            { "source": "customer.address_zipcode", "target": "body_postal_code" },
            { "source": "customer.address_country", "target": "body_country" }
          ],
          "overwrite_existing": false
        },
        "customer_update": {
          "enrichment_type": "field_mapping",
          "field_mappings": [
            { "source": "customer.name", "target": "body_name" },
            { "source": "customer.phone", "target": "body_primary_phone" },
            { "source": "customer.email", "target": "body_primary_email" },
            { "source": "customer.address_street", "target": "body_primary_address" },
            { "source": "customer.address_city", "target": "body_city" },
            { "source": "customer.address_state", "target": "body_province" },
            { "source": "customer.address_zipcode", "target": "body_postal_code" },
            { "source": "customer.address_country", "target": "body_country" }
          ],
          "overwrite_existing": false
        },
        "person_calendar_book": {
          "enrichment_type": "composite",
          "enrichments": [
            {
              "enrich_field": "body_title",
              "condition": "field_empty",
              "source_path": "service.primary_request",
              "format": "template",
              "template": "Service: ${value}"
            },
            {
              "enrich_field": "body_instructions",
              "enrichment_type": "append_text",
              "sections": [
                {
                  "condition": "field_exists:operations.task_id",
                  "template": "\n\nTask ID: ${operations.task_id}\nTask: ${operations.task_name}"
                },
                {
                  "condition": "field_exists:service.primary_request",
                  "template": "\n\nService: ${service.primary_request}"
                },
                {
                  "condition": "field_exists:customer.name",
                  "template": "\n\nCustomer: ${customer.name}\nPhone: ${customer.phone}"
                }
              ]
            },
            {
              "enrich_field": "body_metadata",
              "enrichment_type": "merge_json",
              "additions": {
                "attendees": {
                  "build_from": [
                    {
                      "condition": "field_exists:customer.name",
                      "object": {
                        "name": "${customer.name}",
                        "email": "${customer.email}",
                        "phone": "${customer.phone}",
                        "type": "customer"
                      }
                    },
                    {
                      "condition": "field_exists:assignment.employee_name",
                      "object": {
                        "name": "${assignment.employee_name}",
                        "email": null,
                        "type": "employee"
                      }
                    }
                  ]
                },
                "task_id": "${operations.task_id}",
                "service_type": "${service.catalog_match}"
              }
            }
          ]
        }
      }
    }
  },

  "conversation_tactics": {
    "empathetic_listening": {
      "description": "Acknowledge concern with understanding",
      "when_to_use": "Customer frustrated or concerned",
      "examples": ["I understand how frustrating that must be"]
    },
    "clarifying_questions": {
      "description": "Ask focused questions",
      "when_to_use": "Customer description vague",
      "examples": ["Could you tell me more about what's happening?"]
    },
    "incremental_data_gathering": {
      "description": "Request information naturally",
      "when_to_use": "Need customer contact info",
      "examples": ["To help you best, may I have your phone number?"]
    },
    "rapport_building": {
      "description": "Build trust through reassurance",
      "when_to_use": "After empathy, before requests",
      "examples": ["You're in good hands - we'll get this sorted"]
    },
    "solution_explanation": {
      "description": "Explain plans clearly",
      "when_to_use": "Presenting solution",
      "examples": ["Here's what I recommend: [plan]. Sound good?"]
    },
    "consent_gathering": {
      "description": "Get explicit approval",
      "when_to_use": "Before executing actions",
      "examples": ["Does that plan work for you?"]
    },
    "satisfaction_check": {
      "description": "Verify customer happiness",
      "when_to_use": "After completing actions",
      "examples": ["Is there anything else I can help with?"]
    },
    "graceful_closure": {
      "description": "End professionally",
      "when_to_use": "Final message",
      "examples": ["Thank you for choosing Huron Home Services!"]
    }
  },

  "global_constraints": {
    "max_conversation_turns": 30,
    "max_goal_iterations": 3,
    "mandatory_fields_global": ["service.primary_request", "customer.phone", "customer.name", "customer.address"],
    "timeout_seconds": 600,
    "escalation_triggers": [
      "customer extremely frustrated",
      "conversation exceeds max_turns",
      "request outside capability",
      "customer requests human"
    ]
  }
}
