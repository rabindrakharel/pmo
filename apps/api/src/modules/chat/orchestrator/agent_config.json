{
  "version": "3.0.0",
  "architecture": "goal-oriented-agentic",

  "goals": [
    {
      "goal_id": "WARM_GREETINGS_EMPATHY_UNDERSTAND",
      "description": "Greet customer warmly, show empathy, and understand their request",
      "goal_type": "conversational",
      "is_terminal": false,
      "primary_agent": "conversational_agent",
      "goal_success_criteria": {
        "all_of": [
          {
            "json_path": "service.primary_request",
            "operator": "is_set"
          }
        ],
        "evaluation_mode": "deterministic"
      },
      "mcp_tool_boundary": [
        "update_data_extraction_fields",
        "get_session_memory_data",
        "get_context_data",
        "update_session_memory_data"
      ],
      "conversation_tactics": ["empathetic_listening", "clarifying_questions", "issue_confirmation"],
      "max_turns": 5,
      "goal_branching_condition": {
        "type": "deterministic",
        "rules": [
          {
            "condition": {
              "json_path": "service.primary_request",
              "operator": "is_set"
            },
            "next_goal": "ELICIT_STRUCTURED_INFO"
          },
          {
            "condition": {
              "json_path": "service.primary_request",
              "operator": "is_empty"
            },
            "next_goal": "WARM_GREETINGS_EMPATHY_UNDERSTAND"
          }
        ]
      },
      "examples": [
        {
          "input": "Customer says: 'My heater is broken and it's freezing in here!'",
          "output": {
            "commands_to_run": [],
            "ask_talk_reply_to_customer": "I'm so sorry to hear your heater isn't working! That must be really uncomfortable. Let me help you get this fixed right away. Can you tell me a bit more about what's happening with the heater?",
            "session_memory_data_update": {
              "service": {
                "primary_request": "Heater is broken and customer is cold"
              }
            }
          }
        },
        {
          "input": "Customer says: 'I need someone to fix my sink'",
          "output": {
            "commands_to_run": [],
            "ask_talk_reply_to_customer": "I can definitely help with that! Is it a leak, a clog, or something else going on with your sink?",
            "session_memory_data_update": {
              "service": {
                "primary_request": "Sink repair needed"
              }
            }
          }
        }
      ]
    },
    {
      "goal_id": "ELICIT_STRUCTURED_INFO",
      "description": "Collect customer contact information (phone, name, address) in natural conversation",
      "goal_type": "conversational_with_mcp",
      "is_terminal": false,
      "primary_agent": "conversational_agent",
      "fallback_agent": "mcp_agent",
      "goal_success_criteria": {
        "all_of": [
          {
            "json_path": "customer.phone",
            "operator": "is_set"
          },
          {
            "json_path": "customer.name",
            "operator": "is_set"
          },
          {
            "json_path": "customer.address_street",
            "operator": "is_set"
          },
          {
            "json_path": "customer.address_city",
            "operator": "is_set"
          },
          {
            "json_path": "customer.address_state",
            "operator": "is_set"
          }
        ],
        "evaluation_mode": "deterministic"
      },
      "field_collection_order": [
        "customer.phone",
        "customer.name",
        "customer.address_street",
        "customer.address_city",
        "customer.address_state"
      ],
      "field_validation": {
        "customer.phone": {
          "format": "phone_number",
          "required": true
        },
        "customer.address_street": {
          "format": "street_address",
          "required": true
        }
      },
      "mcp_tool_boundary": [
        "update_data_extraction_fields",
        "get_session_memory_data",
        "get_context_data",
        "update_session_memory_data"
      ],
      "conversation_tactics": ["incremental_data_gathering", "rapport_building"],
      "max_turns": 8,
      "goal_branching_condition": {
        "type": "deterministic",
        "rules": [
          {
            "condition": {
              "json_path": "customer.address_state",
              "operator": "is_set"
            },
            "next_goal": "LOOKUP_UPDATE_CREATE_RECORDS",
            "priority": 1
          }
        ]
      },
      "examples": [
        {
          "input": "Customer says: 'My phone number is 650-555-1234'",
          "output": {
            "commands_to_run": [],
            "ask_talk_reply_to_customer": "Thank you! And may I have your name please?",
            "session_memory_data_update": {
              "customer": {
                "phone": "650-555-1234"
              }
            }
          }
        },
        {
          "input": "Customer says: 'I'm John Smith'",
          "output": {
            "commands_to_run": [],
            "ask_talk_reply_to_customer": "Great, John! What's the address where you need the service?",
            "session_memory_data_update": {
              "customer": {
                "name": "John Smith"
              }
            }
          }
        },
        {
          "input": "Customer says: '123 Main Street, Palo Alto, California'",
          "output": {
            "commands_to_run": [],
            "ask_talk_reply_to_customer": "Perfect! I've got all your information. Let me look up your profile.",
            "session_memory_data_update": {
              "customer": {
                "address_street": "123 Main Street",
                "address_city": "Palo Alto",
                "address_state": "California"
              }
            }
          }
        }
      ]
    },
    {
      "goal_id": "LOOKUP_UPDATE_CREATE_RECORDS",
      "description": "Lookup existing customer record, update if found, or create new customer profile",
      "goal_type": "execution",
      "is_terminal": false,
      "primary_agent": "mcp_agent",
      "fallback_agent": "conversational_agent",
      "goal_success_criteria": {
        "all_of": [
          {
            "json_path": "customer.id",
            "operator": "is_set"
          }
        ],
        "evaluation_mode": "deterministic"
      },
      "mcp_tool_boundary": [
        "customer_get",
        "customer_create",
        "customer_update",
        "update_data_extraction_fields",
        "get_session_memory_data",
        "get_context_data",
        "update_session_memory_data"
      ],
      "conversation_tactics": ["progress_updates"],
      "max_turns": 3,
      "goal_branching_condition": {
        "type": "deterministic",
        "rules": [
          {
            "condition": {
              "json_path": "customer.id",
              "operator": "is_set"
            },
            "next_goal": "DESIGN_SOLUTION"
          },
          {
            "condition": {
              "json_path": "customer.id",
              "operator": "is_empty"
            },
            "next_goal": "LOOKUP_UPDATE_CREATE_RECORDS"
          }
        ]
      },
      "examples": [
        {
          "input": "We have customer.phone='650-555-1234', customer.name='John Smith', customer.address_street='123 Main St', customer.address_city='Palo Alto', customer.address_state='CA'",
          "output": {
            "commands_to_run": [
              {
                "tool": "customer_get",
                "params": {
                  "body_primary_phone": "650-555-1234"
                }
              }
            ],
            "ask_talk_reply_to_customer": "Let me check if you're already in our system..."
          }
        },
        {
          "input": "customer_get returned customer with id='cust-123'",
          "output": {
            "commands_to_run": [
              {
                "tool": "update_session_memory",
                "params": {
                  "path": "customer.id",
                  "value": "cust-123"
                }
              },
              {
                "tool": "customer_update",
                "params": {
                  "id": "cust-123",
                  "body_name": "John Smith",
                  "body_primary_address": "123 Main St",
                  "body_city": "Palo Alto",
                  "body_province": "CA"
                }
              }
            ],
            "ask_talk_reply_to_customer": "Great! I've updated your profile. Let me find the best solution for your heating issue."
          }
        },
        {
          "input": "customer_get returned no results",
          "output": {
            "commands_to_run": [
              {
                "tool": "customer_create",
                "params": {
                  "body_name": "John Smith",
                  "body_primary_phone": "650-555-1234",
                  "body_primary_address": "123 Main St",
                  "body_city": "Palo Alto",
                  "body_province": "CA"
                }
              }
            ],
            "ask_talk_reply_to_customer": "I've created your profile in our system. Let me find the best solution for you."
          }
        }
      ]
    },
    {
      "goal_id": "DESIGN_SOLUTION",
      "description": "Create plan to resolve customer request and find available employees",
      "goal_type": "planning_with_mcp",
      "is_terminal": false,
      "primary_agent": "mcp_agent",
      "fallback_agent": "conversational_agent",
      "goal_success_criteria": {
        "all_of": [
          {
            "json_path": "operations.solution_plan",
            "operator": "is_set"
          },
          {
            "json_path": "assignment.employee_id",
            "operator": "is_set"
          }
        ],
        "evaluation_mode": "deterministic"
      },
      "mcp_tool_boundary": [
        "employee_list",
        "service_list",
        "setting_list",
        "update_data_extraction_fields",
        "get_session_memory_data",
        "get_context_data",
        "update_session_memory_data"
      ],
      "conversation_tactics": ["solution_explanation", "consent_gathering"],
      "max_turns": 6,
      "goal_branching_condition": {
        "type": "hybrid",
        "rules": [
          {
            "condition": {
              "json_path": "operations.solution_plan",
              "operator": "is_set"
            },
            "next_goal": "EXECUTE_SOLUTION",
            "priority": 1
          },
          {
            "condition": "customer rejects plan",
            "next_goal": "DESIGN_SOLUTION",
            "priority": 2,
            "loop_prevention": {
              "max_iterations": 2
            }
          }
        ]
      },
      "examples": [
        {
          "input": "We have service.primary_request='heater repair', customer.id='cust-123'",
          "output": {
            "commands_to_run": [
              {
                "tool": "employee_list",
                "params": {}
              }
            ],
            "ask_talk_reply_to_customer": "Let me find an available technician for your heater repair..."
          }
        },
        {
          "input": "employee_list returned 3 technicians. We need to select one and create a plan.",
          "output": {
            "commands_to_run": [
              {
                "tool": "update_session_memory",
                "params": {
                  "path": "assignment.employee_id",
                  "value": "emp-456"
                }
              },
              {
                "tool": "update_session_memory",
                "params": {
                  "path": "operations.solution_plan",
                  "value": "Assign technician emp-456 for heater repair tomorrow at 9 AM"
                }
              }
            ],
            "ask_talk_reply_to_customer": "I've found a great technician for your heater repair! We can schedule them for tomorrow morning at 9 AM. Does that work for you?"
          }
        }
      ]
    },
    {
      "goal_id": "EXECUTE_SOLUTION",
      "description": "Execute the planned actions (create task, book appointment)",
      "goal_type": "execution",
      "is_terminal": false,
      "primary_agent": "mcp_agent",
      "fallback_agent": "conversational_agent",
      "goal_success_criteria": {
        "all_of": [
          {
            "json_path": "operations.task_id",
            "operator": "is_set"
          }
        ],
        "evaluation_mode": "deterministic"
      },
      "mcp_tool_boundary": [
        "task_create",
        "person_calendar_book",
        "update_data_extraction_fields",
        "get_session_memory_data",
        "get_context_data",
        "update_session_memory_data"
      ],
      "conversation_tactics": ["progress_updates", "success_confirmation"],
      "max_turns": 6,
      "goal_branching_condition": {
        "type": "deterministic",
        "rules": [
          {
            "condition": {
              "json_path": "operations.task_id",
              "operator": "is_set"
            },
            "next_goal": "CONFIRM_RESOLUTION"
          },
          {
            "condition": {
              "json_path": "operations.task_id",
              "operator": "is_empty"
            },
            "next_goal": "EXECUTE_SOLUTION"
          }
        ]
      },
      "examples": [
        {
          "input": "Customer consented to the plan. We have customer.id='cust-123', service.primary_request='heater repair', assignment.employee_id='emp-456'",
          "output": {
            "commands_to_run": [
              {
                "tool": "task_create",
                "params": {
                  "body_name": "Heater Repair",
                  "body_assignee": "emp-456"
                }
              }
            ],
            "ask_talk_reply_to_customer": "Creating your service ticket now..."
          }
        },
        {
          "input": "task_create returned task with id='task-789'",
          "output": {
            "commands_to_run": [
              {
                "tool": "update_session_memory",
                "params": {
                  "path": "operations.task_id",
                  "value": "task-789"
                }
              }
            ],
            "ask_talk_reply_to_customer": "Perfect! I've created your service ticket and assigned our technician. You'll receive a confirmation shortly. Is there anything else you need help with?"
          }
        }
      ]
    },
    {
      "goal_id": "CONFIRM_RESOLUTION",
      "description": "Verify satisfaction and close conversation",
      "goal_type": "terminal",
      "is_terminal": true,
      "primary_agent": "conversational_agent",
      "fallback_agent": "mcp_agent",
      "goal_success_criteria": {
        "evaluation_mode": "semantic"
      },
      "mcp_tool_boundary": [
        "call_hangup",
        "update_data_extraction_fields",
        "get_session_memory_data",
        "get_context_data",
        "update_session_memory_data"
      ],
      "conversation_tactics": ["satisfaction_check", "graceful_closure"],
      "max_turns": 3,
      "termination_sequence": {
        "enabled": true,
        "steps": [
          {
            "step": 1,
            "action": "conversational_goodbye",
            "agent": "conversational_agent",
            "message_template": "Thank you for choosing Huron Home Services! We'll take care of everything. Have a great day!",
            "tactics": ["graceful_closure"]
          },
          {
            "step": 2,
            "action": "execute_mcp_hangup",
            "agent": "mcp_agent",
            "required_tool": "call_hangup",
            "description": "Terminate chat session via MCP"
          }
        ],
        "on_completion": "END"
      },
      "goal_branching_condition": {
        "type": "semantic",
        "rules": [
          {
            "condition": "customer satisfied and no additional requests",
            "next_goal": "END"
          }
        ]
      }
    }
  ],

  "agent_profiles": {
    "conversational_agent": {
      "identity": "Empathetic customer service specialist",
      "capabilities": ["natural_conversation", "empathy_expression", "question_asking"],
      "personality_traits": {
        "empathy_level": "high",
        "formality": "professional_friendly",
        "verbosity": "concise"
      },
      "system_prompt": "You are an empathetic customer service agent for Huron Home Services.\n\nCore principles:\n1. Listen before asking - review conversation history FIRST\n2. Never repeat questions already answered\n3. Build trust through genuine empathy\n4. Keep responses concise (1-3 sentences)\n5. Match customer's emotional tone\n\nYour goal: Help customers efficiently while making them feel heard.\n\n{{SESSION_MEMORY_DATA}}",
      "tactics_library": {
        "empathetic_listening": "Acknowledge customer concern with understanding",
        "clarifying_questions": "Ask focused questions without interrogation",
        "rapport_building": "Build trust through reassurance",
        "incremental_data_gathering": "Request information naturally",
        "solution_explanation": "Explain plans clearly",
        "satisfaction_check": "Verify customer happiness",
        "graceful_closure": "End professionally and warmly"
      }
    },
    "mcp_agent": {
      "identity": "External systems integration specialist",
      "capabilities": ["entity_scoped_tool_access", "tool_selection", "tool_execution", "customer_profile_management"],
      "system_prompt": "Execute external calls via MCP tools. Analyze context, select tool, execute with correct parameters, handle errors gracefully.\n\n**CUSTOMER PROFILE WORKFLOW (LOOKUP_UPDATE_CREATE_RECORDS goal):**\n1. Search for existing customer: Call customer_get with phone number from context\n2. If customer found: Call customer_update with any new data (name, email, address fields)\n3. If customer NOT found: Call customer_create with complete profile (name, phone, email, address_street, address_city, address_state, address_zipcode)\n4. Extract customer.id from response and update session memory\n5. Confirm to user: \"I've updated your profile\" or \"I've created your profile\"\n\n**SOLUTION DESIGN WORKFLOW (DESIGN_SOLUTION goal):**\n1. Search for matching service: Call setting_list or service_list based on service.primary_request\n2. Search for available employees: Call employee_list to find qualified employees\n3. Select best match employee and store assignment.employee_id in session memory\n4. Create solution plan with: service type, assigned employee, estimated timeline\n5. Present plan to customer and ask for consent\n\n**IMPORTANT:** Always execute customer lookup/create BEFORE task creation. Use fine-grained address fields. Only use tools specified in mcp_tool_boundary for the current goal.",
      "entity_boundary": {
        "description": "Dynamically limit MCP tools to relevant entities based on conversation context. Reduces LLM token usage and improves tool selection accuracy.",
        "default_entities": ["Customer", "Task", "Employee", "Calendar", "Settings"],
        "expansion_rules": {
          "if_service_catalog_matched": {
            "add_entities": ["Product", "Sales"]
          },
          "if_project_mentioned": {
            "add_entities": ["Project", "Wiki", "Artifact", "Form"]
          },
          "if_appointment_booking": {
            "add_entities": ["Booking", "Interaction"]
          }
        },
        "always_include_categories": ["Settings", "Linkage"],
        "never_include_categories": ["Authentication", "System"]
      },
      "tool_selection_strategy": {
        "customer_get": "Use when customer.phone or customer.email exists but customer.id is empty. Search by phone or email.",
        "customer_create": "Use after customer_get returns no results. Create customer with name (required), phone, email, and fine-grained address (street, city, state, zipcode, country).",
        "customer_update": "Use when customer.id exists and new customer data is available. Update incrementally with fine-grained address fields (street, city, state, zipcode, country).",
        "task_create": "Use when solution approved and service identified. Task description is auto-enriched with customer data + conversation history.",
        "person_calendar_book": "Use when task_id exists and calendar slot available. Event is auto-enriched with task reference + attendees (customer email, employee email)."
      },
      "customer_profile_workflow": {
        "step_1": "Search for existing customer via customer_get (by phone or email)",
        "step_2": "If found: Update customer profile via customer_update with any new data (address components, email, etc.)",
        "step_3": "If not found: Create new customer profile via customer_create with all extracted data",
        "step_4": "Store customer.id in context for task/project linking",
        "required_fields_for_creation": ["name", "phone"],
        "optional_fields_for_creation": ["email", "address_street", "address_city", "address_state", "address_zipcode", "address_country"],
        "update_incrementally": true
      },
      "tool_enrichment_rules": {
        "task_create": {
          "enrich_field": "body_descr",
          "enrichment_type": "append_markdown",
          "sections": [
            {
              "title": "Customer Information",
              "source_paths": [
                { "label": "Name", "path": "customer.name" },
                { "label": "Phone", "path": "customer.phone" },
                { "label": "Email", "path": "customer.email" },
                { "label": "Address", "path": "customer.address", "format": "address_components", "components": ["address_street", "address_city", "address_state", "address_zipcode", "address_country"] }
              ]
            },
            {
              "title": "Service Request",
              "source_paths": [
                { "label": "Request", "path": "service.primary_request" },
                { "label": "Service Type", "path": "service.catalog_match" }
              ]
            },
            {
              "title": "Conversation History",
              "source_path": "summary_of_conversation_on_each_step_until_now",
              "format": "conversation_exchanges"
            }
          ]
        },
        "customer_create": {
          "enrichment_type": "field_mapping",
          "field_mappings": [
            { "source": "customer.name", "target": "body_name" },
            { "source": "customer.phone", "target": "body_primary_phone" },
            { "source": "customer.email", "target": "body_primary_email" },
            { "source": "customer.address_street", "target": "body_primary_address" },
            { "source": "customer.address_city", "target": "body_city" },
            { "source": "customer.address_state", "target": "body_province" },
            { "source": "customer.address_zipcode", "target": "body_postal_code" },
            { "source": "customer.address_country", "target": "body_country" }
          ],
          "overwrite_existing": false
        },
        "customer_update": {
          "enrichment_type": "field_mapping",
          "field_mappings": [
            { "source": "customer.name", "target": "body_name" },
            { "source": "customer.phone", "target": "body_primary_phone" },
            { "source": "customer.email", "target": "body_primary_email" },
            { "source": "customer.address_street", "target": "body_primary_address" },
            { "source": "customer.address_city", "target": "body_city" },
            { "source": "customer.address_state", "target": "body_province" },
            { "source": "customer.address_zipcode", "target": "body_postal_code" },
            { "source": "customer.address_country", "target": "body_country" }
          ],
          "overwrite_existing": false
        },
        "person_calendar_book": {
          "enrichment_type": "composite",
          "enrichments": [
            {
              "enrich_field": "body_title",
              "condition": "field_empty",
              "source_path": "service.primary_request",
              "format": "template",
              "template": "Service: ${value}"
            },
            {
              "enrich_field": "body_instructions",
              "enrichment_type": "append_text",
              "sections": [
                {
                  "condition": "field_exists:operations.task_id",
                  "template": "\n\nTask ID: ${operations.task_id}\nTask: ${operations.task_name}"
                },
                {
                  "condition": "field_exists:service.primary_request",
                  "template": "\n\nService: ${service.primary_request}"
                },
                {
                  "condition": "field_exists:customer.name",
                  "template": "\n\nCustomer: ${customer.name}\nPhone: ${customer.phone}"
                }
              ]
            },
            {
              "enrich_field": "body_metadata",
              "enrichment_type": "merge_json",
              "additions": {
                "attendees": {
                  "build_from": [
                    {
                      "condition": "field_exists:customer.name",
                      "object": {
                        "name": "${customer.name}",
                        "email": "${customer.email}",
                        "phone": "${customer.phone}",
                        "type": "customer"
                      }
                    },
                    {
                      "condition": "field_exists:assignment.employee_name",
                      "object": {
                        "name": "${assignment.employee_name}",
                        "email": null,
                        "type": "employee"
                      }
                    }
                  ]
                },
                "task_id": "${operations.task_id}",
                "service_type": "${service.catalog_match}"
              }
            }
          ]
        }
      }
    }
  },

  "conversation_tactics": {
    "empathetic_listening": {
      "description": "Acknowledge concern with understanding",
      "when_to_use": "Customer frustrated or concerned",
      "examples": ["I understand how frustrating that must be"]
    },
    "clarifying_questions": {
      "description": "Ask focused questions",
      "when_to_use": "Customer description vague",
      "examples": ["Could you tell me more about what's happening?"]
    },
    "incremental_data_gathering": {
      "description": "Request information naturally",
      "when_to_use": "Need customer contact info",
      "examples": ["To help you best, may I have your phone number?"]
    },
    "rapport_building": {
      "description": "Build trust through reassurance",
      "when_to_use": "After empathy, before requests",
      "examples": ["You're in good hands - we'll get this sorted"]
    },
    "solution_explanation": {
      "description": "Explain plans clearly",
      "when_to_use": "Presenting solution",
      "examples": ["Here's what I recommend: [plan]. Sound good?"]
    },
    "consent_gathering": {
      "description": "Get explicit approval",
      "when_to_use": "Before executing actions",
      "examples": ["Does that plan work for you?"]
    },
    "satisfaction_check": {
      "description": "Verify customer happiness",
      "when_to_use": "After completing actions",
      "examples": ["Is there anything else I can help with?"]
    },
    "graceful_closure": {
      "description": "End professionally",
      "when_to_use": "Final message",
      "examples": ["Thank you for choosing Huron Home Services!"]
    }
  },

  "global_constraints": {
    "max_conversation_turns": 30,
    "max_goal_iterations": 3,
    "mandatory_fields_global": ["service.primary_request", "customer.phone", "customer.name", "customer.address_street", "customer.address_city", "customer.address_state"],
    "timeout_seconds": 600,
    "escalation_triggers": [
      "customer extremely frustrated",
      "conversation exceeds max_turns",
      "request outside capability",
      "customer requests human"
    ]
  }
}
